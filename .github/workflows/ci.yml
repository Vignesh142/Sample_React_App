name: CI Pipeline

on:
    push:
        branches:
            - main
            - dev
    pull_request:
        branches:
            - main
            - dev

jobs:
    build:
        name: Build and Test React App
        runs-on: ubuntu-latest

        permissions:
            contents: read
            pull-requests: write
            
        steps:
            - name: Show Environment Variables
              run: env

            - name: Multi-line Message
              run: |
                echo "âœ… Starting Build"
                echo "ðŸ”¨ Installing Dependencies"
                echo "ðŸŽ¯ Running Tests"

            - name: Checkout Code
              uses: actions/checkout@v3

            - name: Setup NodeJS
              uses: actions/setup-node@v4
              with: 
                node-version: '20'
            - name: Install Dependencies
              uses: actions/cache@v3
              with: 
                path: ~/.npm
                key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                restore-keys: |
                  ${{ runner.os }}-node-
            
            - name: Install Dependencies
              run: npm install --frozen-lockfile

            - name: Build Project
              run: npm run build

            - name: Completed CI Pipeline
              run: echo "CI Pipeline Completed Successfully"

            # âœ… Save Artifacts for Later Use in Deployment
            - name: Save Build Output
              uses: actions/upload-artifact@v4
              with:
                name: build-output
                path: build

            - name: Save Node Modules
              uses: actions/cache@v3
              with:
                path: ~/.yarn
                key: yarn-${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
